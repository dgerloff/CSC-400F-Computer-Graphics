<!doctype html>
<html>
	<head>
</head>
	<body>
		<canvas width = "512" height = "512" id = "glcanvas">
			Support for the canvas element is required.
		</canvas>
		<script src='gl-matrix-min.js'></script>
		<script src='utilities.js'></script>		
		<script src='shape.js'></script>
		<script src='triangle.js'></script>
		<script src='shaders.js'></script>
		<script src='colorful_shader.js'></script>
		<script src='solid_shader.js'></script>


		<script>
			var canvas = document.getElementById('glcanvas');
			var gl = canvas.getContext('webgl2');

			function RangeRand(min, max)
			{
				return (max - min) * Math.random() + min;
			}

			function RandomVertex(min, max)
			{
				return [RangeRand(min, max), RangeRand(min, max), RangeRand(min, max)];
			}

			

			//var modelview_matrix_handle = gl.getUniformLocation(colorfulShaderProgram, "modelview_matrix");
			//var projection_matrix_handle = gl.getUniformLocation(colorfulShaderProgram, "projection_matrix");
			//var color_attribute_handle = gl.getAttribLocation(colorfulShaderProgram, "vertex_color");
			//var vertex_attribute_handle = gl.getAttribLocation(colorfulShaderProgram, "vertex_coordinates");

			//var solid_modelview_matrix_handle = gl.getUniformLocation(solidShaderProgram, "modelview_matrix");
			//var solid_projection_matrix_handle = gl.getUniformLocation(solidShaderProgram, "projection_matrix");
			//var solid_color_uniform_handle = gl.getUniformLocation(solidShaderProgram, "u_color");
			//var solid_vertex_attribute_handle = gl.getAttribLocation(solidShaderProgram, "vertex_coordinates");


			var draw_normals = false;
			var draw_wireframe = false;
			var show_triangles = false;

			document.addEventListener('keydown', function(event) 
			{
				// http://keycode.info/ is a useful resource for identifying keycode numbers.
				switch (event.keyCode)
				{
					case 82:
						let v = RandomVertex(-1, 1).concat(RandomVertex(-1,1).concat(RandomVertex(-1,1)));
						triangle.Reshape(v);
						break;

					case 78:
						draw_normals = !draw_normals;
						break;

					case 84:
						show_triangles = !show_triangles;
						break;

					case 87:
						draw_wireframe = !draw_wireframe;
						break;
				}
			}
		)
			var triangle = new Triangle();

			function Draw(now)
			{
				gl.enable(gl.DEPTH_TEST);
				gl.depthFunc(gl.LEQUAL);
				gl.clearColor(0.01, 0.01, 0.2, 1.0);
				gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
				gl.viewport(0, 0, canvas.width, canvas.height);

				// now is delivered in milliseconds. This converts it to seconds.
				now = now / 1000.0;
			
				var prj = mat4.create();
				mat4.perspective(prj, Radians(50.0), canvas.width / canvas.height, 0.5, 10.0);
				
				var mdv = mat4.create();
				mat4.lookAt(mdv, [0.0, 0.0, 5.0], [0.0, 0.0, 0.0], [0.0, 1.0, 0.0]);
				mat4.rotate(mdv, mdv, Radians(now * 90.0), [0.0, 1.0, 0.0]);
				temp = new SolidColorShader(mdv,prj);
				color = new ColorfulShader(mdv,prj);
				if (!draw_wireframe)
				{
					gl.useProgram(color);
					triangle.Draw(gl.getAttribLocation(color, "a_vertex_coordinates"), gl.getAttribLocation(color, "a_vertex_color"), true, false, false, false);
				}

				if (draw_wireframe || show_triangles)
				{
					gl.useProgram(temp);
					triangle.Draw(gl.getAttribLocation(temp, "a_vertex_coordinates"), null, false, false, draw_wireframe, show_triangles);	
				}

				if (draw_normals)
				{
					gl.useProgram(temp);
					triangle.Draw(gl.getAttribLocation(temp, "a_vertex_coordinates"), null, false, true, false, false);
				}
				gl.useProgram(null);

				requestAnimationFrame(Draw);
			}

			requestAnimationFrame(Draw);
		</script>
	</body>
</html>